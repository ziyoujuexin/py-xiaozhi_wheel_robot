# é¡¹ç›®æ‰“åŒ…æ•™ç¨‹

## æ¦‚è¿°

UnifyPy 2.0 æ˜¯ä¸€ä¸ªè·¨å¹³å°Pythonåº”ç”¨æ‰“åŒ…å·¥å…·ï¼Œæ”¯æŒå°†Pythoné¡¹ç›®æ‰“åŒ…ä¸ºWindows (EXE)ã€macOS (DMG)ã€Linux (DEB)å¹³å°çš„åŸç”Ÿå®‰è£…åŒ…ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼šäº¤äº’å¼é…ç½®å‘å¯¼ã€æ™ºèƒ½è·¯å¾„å¤„ç†ã€è‡ªåŠ¨æƒé™ç®¡ç†ã€å¹¶è¡Œæ„å»ºã€å›æ»šç³»ç»Ÿã€‚

> ğŸ“š **å®Œæ•´æ–‡æ¡£**ï¼š[UnifyPy GitHubä»“åº“](https://github.com/huangjunsen0406/UnifyPy)

## ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£…é¡¹ç›®ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/py-xiaozhi

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt        # Windows/Linux
pip install -r requirements_mac.txt    # macOS
```

### 2. å®‰è£…UnifyPy

```bash
pip install unifypy
```

> **è¯´æ˜**ï¼šUnifyPyä½¿ç”¨PyInstalleræ‰“åŒ…ï¼Œéœ€è¦è®¿é—®å½“å‰ç¯å¢ƒä¸­çš„æ‰€æœ‰PythonåŒ…ã€‚ç¡®ä¿UnifyPyå’Œé¡¹ç›®ä¾èµ–åœ¨åŒä¸€ç¯å¢ƒä¸­å®‰è£…ã€‚

### 3. å¹³å°ç‰¹å®šå·¥å…·

#### Windowså¹³å°

å®‰è£… [Inno Setup](https://jrsoftware.org/isdl.php)ï¼ˆç”¨äºåˆ›å»ºå®‰è£…ç¨‹åºï¼‰

- å®‰è£…åï¼Œåœ¨build.jsonä¸­é…ç½®è·¯å¾„ï¼Œæˆ–è®¾ç½®ç¯å¢ƒå˜é‡ `INNO_SETUP_PATH`

#### macOSå¹³å°

- æ— éœ€é¢å¤–å®‰è£…ï¼ˆUnifyPyå†…ç½®create-dmgå·¥å…·ï¼‰

#### Linuxå¹³å°

**å®‰è£…æ‰“åŒ…å·¥å…·**ï¼š

```bash
# DEBæ ¼å¼æ‰“åŒ…å·¥å…·
sudo apt-get install dpkg-dev fakeroot
```

**å®‰è£…ç¼–è¯‘ç¯å¢ƒ**ï¼ˆé‡è¦ï¼‰ï¼š

```bash
# å®‰è£…å¼€å‘å·¥å…·å’Œåº“ï¼ˆNumPyç­‰ä¾èµ–éœ€è¦ï¼‰
sudo apt update
sudo apt install -y build-essential python3-dev python3-pip python3-setuptools \
    libopenblas-dev liblapack-dev gfortran patchelf autoconf automake \
    libtool cmake libssl-dev libatlas-base-dev

# å®‰è£…æ„å»ºç³»ç»Ÿ
pip install meson ninja
sudo apt install -y meson ninja-build
```

**NumPyç¼–è¯‘ç¯å¢ƒé…ç½®**ï¼š

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export BLAS=openblas
export LAPACK=openblas
export NPY_NUM_BUILD_JOBS=$(nproc)

# éªŒè¯NumPyå¯ç”¨
python -c "import numpy; print('NumPy version:', numpy.__version__)"
```

> **æç¤º**ï¼šå»ºè®®ä½¿ç”¨condaç¯å¢ƒï¼Œå¯é¿å…å¤§éƒ¨åˆ†ç¼–è¯‘é—®é¢˜ï¼š
> ```bash
> conda create -n build_env python=3.9
> conda activate build_env
> conda install numpy scipy openblas-devel
> pip install unifypy
> ```

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šäº¤äº’å¼å‘å¯¼ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰

```bash
# åœ¨é¡¹ç›®ç›®å½•å¯åŠ¨é…ç½®å‘å¯¼
cd /path/to/py-xiaozhi
unifypy . --init
```

å‘å¯¼ä¼šå¼•å¯¼ä½ å®Œæˆï¼š
1. åŸºç¡€ä¿¡æ¯é…ç½®ï¼ˆåç§°ã€ç‰ˆæœ¬ã€å…¥å£æ–‡ä»¶ï¼‰
2. ç›®æ ‡å¹³å°é€‰æ‹©ï¼ˆWindows/macOS/Linuxï¼‰
3. PyInstalleré…ç½®ï¼ˆå•æ–‡ä»¶/çª—å£æ¨¡å¼ã€æ•°æ®ç›®å½•ï¼‰
4. å¹³å°ç‰¹å®šé…ç½®ï¼ˆæƒé™ã€å›¾æ ‡ã€å®‰è£…é€‰é¡¹ï¼‰
5. è‡ªåŠ¨ç”Ÿæˆ `build.json` å¹¶å¯é€‰æ‹©ç«‹å³æ„å»º

### æ–¹å¼äºŒï¼šä½¿ç”¨ç°æœ‰é…ç½®

é¡¹ç›®å·²åŒ…å«é¢„é…ç½®çš„ `build.json`ï¼Œç›´æ¥æ‰“åŒ…ï¼š

```bash
# åŸºæœ¬æ‰“åŒ…
unifypy . --config build.json

# æ¸…ç†é‡æ–°æ„å»º
unifypy . --config build.json --clean

# è¯¦ç»†è¾“å‡ºï¼ˆæ¨èï¼‰
unifypy . --config build.json --verbose

# åªç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
unifypy . --config build.json --skip-installer

# å¹¶è¡Œæ„å»ºå¤šç§æ ¼å¼
unifypy . --config build.json --parallel --max-workers 4
```

## å„å¹³å°æ‰“åŒ…å‘½ä»¤

### Windows

```bash
unifypy . --config build.json
```

è¾“å‡ºï¼š
- å¯æ‰§è¡Œæ–‡ä»¶ï¼š`dist/xiaozhi/`
- å®‰è£…ç¨‹åºï¼š`dist/installer/xiaozhi-1.0.0-setup.exe`

### macOS

```bash
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é…ç½®æƒé™ï¼‰
unifypy . --config build.json --development

# ç”Ÿäº§æ¨¡å¼
unifypy . --config build.json
```

è¾“å‡ºï¼š
- åº”ç”¨ç¨‹åºåŒ…ï¼š`dist/xiaozhi/XiaoZhi.app`
- ç£ç›˜é•œåƒï¼š`dist/installer/xiaozhi-1.0.0.dmg`

### Linux

```bash
unifypy . --config build.json
```

è¾“å‡ºï¼š
- å¯æ‰§è¡Œæ–‡ä»¶ï¼š`dist/xiaozhi/`
- DEBå®‰è£…åŒ…ï¼š`dist/installer/xiaozhi-1.0.0.deb`

## Linuxå¹³å°ç‰¹æ®Šè¯´æ˜

### NumPyç¼–è¯‘é—®é¢˜

**ç—‡çŠ¶**ï¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€ç¼ºå°‘BLAS/LAPACKåº“ç­‰

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ–¹æ¡ˆ1: æ£€æŸ¥å¹¶å®‰è£…ç¼ºå¤±çš„å¼€å‘åº“
sudo apt install -y libopenblas-dev liblapack-dev gfortran

# æ–¹æ¡ˆ2: ä½¿ç”¨é¢„ç¼–è¯‘wheelåŒ…ï¼ˆæ¨èï¼‰
pip install numpy --force-reinstall

# æ–¹æ¡ˆ3: è®¾ç½®ç¯å¢ƒå˜é‡åé‡è£…
export BLAS=openblas
export LAPACK=openblas
export NPY_NUM_BUILD_JOBS=4
pip install numpy --no-cache-dir

# æ–¹æ¡ˆ4: ä½¿ç”¨condaç¯å¢ƒï¼ˆæœ€ç¨³å®šï¼‰
conda install numpy scipy openblas-devel
```

### ä¾èµ–å…¼å®¹æ€§

æ‰“åŒ…åçš„ç¨‹åºåœ¨å…¶ä»–Linuxç³»ç»Ÿä¸Šæ— æ³•è¿è¡Œï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨è¾ƒè€çš„Linuxå‘è¡Œç‰ˆä¸Šæ„å»ºï¼Œæ¨èä½¿ç”¨ï¼š
- Ubuntu 18.04 LTS æˆ– 20.04 LTS
- CentOS 7

æˆ–ä½¿ç”¨é™æ€é“¾æ¥ï¼š
```bash
pip install staticx
```

## å¸¸è§é—®é¢˜

### Q1: é¦–æ¬¡ä½¿ç”¨ä¸çŸ¥é“å¦‚ä½•é…ç½®ï¼Ÿ

```bash
unifypy . --init  # ä½¿ç”¨äº¤äº’å¼å‘å¯¼
```

### Q2: æ‰“åŒ…å¤±è´¥ï¼Ÿ

```bash
# æ¸…ç†åé‡è¯•ï¼Œå¯ç”¨è¯¦ç»†è¾“å‡º
unifypy . --config build.json --clean --verbose
```

### Q3: macOSæƒé™é…ç½®é—®é¢˜ï¼Ÿ

```bash
# ä½¿ç”¨å¼€å‘æ¨¡å¼è‡ªåŠ¨ç”Ÿæˆæƒé™æ–‡ä»¶
unifypy . --config build.json --development --verbose
```

### Q4: ä¾èµ–å†²çªï¼Ÿ

```bash
# åˆ›å»ºç»Ÿä¸€ç¯å¢ƒ
conda create -n packaging python=3.9
conda activate packaging
pip install unifypy
pip install -r requirements.txt
```

### Q5: é…ç½®æ–‡ä»¶è·¯å¾„æ‰¾ä¸åˆ°ï¼Ÿ

UnifyPy 2.0ä½¿ç”¨æ™ºèƒ½è·¯å¾„å¤„ç†ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„ç›¸å¯¹è·¯å¾„ä¼šè‡ªåŠ¨è§£æä¸ºç›¸å¯¹äº**é¡¹ç›®ç›®å½•**çš„ç»å¯¹è·¯å¾„ã€‚

ç¤ºä¾‹ï¼š
```json
{
  "icon": "assets/icon.png"  // è‡ªåŠ¨è§£æä¸º /path/to/project/assets/icon.png
}
```

## é«˜çº§åŠŸèƒ½

### å›æ»šç³»ç»Ÿ

```bash
# åˆ—å‡ºå¯ç”¨å›æ»šä¼šè¯
unifypy . --list-rollback

# å›æ»šåˆ°æŒ‡å®šä¼šè¯
unifypy . --rollback SESSION_ID
```

### å¹¶è¡Œæ„å»º

```bash
# å¤šæ ¼å¼å¹¶è¡Œæ„å»º
unifypy . --config build.json --parallel --max-workers 4
```

### macOSæƒé™è‡ªåŠ¨ç®¡ç†

UnifyPyè‡ªåŠ¨ç”Ÿæˆentitlements.plistå’Œæ›´æ–°Info.plistï¼š

```bash
# å¼€å‘æ¨¡å¼ï¼ˆåŒ…å«è°ƒè¯•æƒé™ï¼‰
unifypy . --config build.json --development

# ç”Ÿäº§æ¨¡å¼ï¼ˆä»…å¿…è¦æƒé™ï¼‰
unifypy . --config build.json --production
```

## æ›´å¤šä¿¡æ¯

- **å®Œæ•´é…ç½®æ–‡æ¡£**ï¼šæŸ¥çœ‹ [UnifyPy README](https://github.com/huangjunsen0406/UnifyPy)
- **é«˜çº§é…ç½®ç¤ºä¾‹**ï¼šå‚è€ƒä»“åº“ä¸­çš„ `build_comprehensive.json`
- **PyInstallerå‚æ•°**ï¼šå‚è€ƒ [PyInstallerå®˜æ–¹æ–‡æ¡£](https://pyinstaller.org/en/stable/usage.html)

## æœ€ä½³å®è·µ

1. **ç¯å¢ƒç®¡ç†**ï¼šä½¿ç”¨condaåˆ›å»ºä¸“ç”¨æ‰“åŒ…ç¯å¢ƒ
2. **é¦–æ¬¡ä½¿ç”¨**ï¼šä½¿ç”¨ `--init` å‘å¯¼å¿«é€Ÿç”Ÿæˆé…ç½®
3. **è°ƒè¯•æ„å»º**ï¼šå§‹ç»ˆä½¿ç”¨ `--verbose` å‚æ•°
4. **æ¸…ç†æ„å»º**ï¼šå®šæœŸä½¿ç”¨ `--clean` ç¡®ä¿æ„å»ºå¹²å‡€
5. **Linuxæ‰“åŒ…**ï¼šåœ¨Ubuntu 18.04/20.04ä¸Šæ„å»ºä»¥ç¡®ä¿å…¼å®¹æ€§
6. **macOSæ‰“åŒ…**ï¼šå¼€å‘é˜¶æ®µä½¿ç”¨ `--development` æ¨¡å¼
